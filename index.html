<!DOCTYPE html>
<html>
  <head>
    <title>NFT Minting Dapp</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://unpkg.com/moralis/dist/moralis.js"></script>
  </head>
  <body>
    <div>
      <button onclick="login()">Connect Wallet</button>
    </div>
  </body>

  <script>
    const serverUrl = "https://tpqv6uquu5kz.usemoralis.com:2053/server";
    const appId = "IEcRKXYkbKeOBoXxELfnLakmvxmjwK3hotK7RTTq";
    const signUnpMessage = "Hello Web3";
    Moralis.start({
      serverUrl,
      appId,
    });
    function login() {
      Moralis.authenticate().then(async (user) => {
        let response = await fetch("./backend/abis/Platform.json");
        let Contract = await response.json();
        if (!window.ethereum) {
          if (!Moralis.provider) {
            await Moralis.enableWeb3({ provider: "walletconnect" });
          }
        } else {
          if (!Moralis.provider) {
            await Moralis.enableWeb3();
          }
        }
        const web3Now = new Web3(Moralis.provider);
        let accounts = await web3Now.eth.getAccounts();
        let tokenContract = new web3Now.eth.Contract(Contract.abi, "0x6cA565b71bC3DE89f57BF729b7aA4835978f1786");
        let netId = 80001;
        tokenContract
          .methods.addEvent("Test Event", "TeeV", "Tech Hub Nigeria", netId,  [
                { name: "VIP", description: "Ticket for the superbosses", ticket_type: "paid", quantity_available: 20, max_per_order: 10, price: 5000 },
                { name: "Regular", description: "Ticket for the masses", ticket_type: "cheap", quantity_available: 1000, max_per_order: 10, price: 50 },
                { name: "Premium", description: "Ticket for the bosses", ticket_type: "free", quantity_available: 200, max_per_order: 10, price: 500 },
              ],  (new Date()).getTime(), 
              "Tech event", "Sample event for tech newbies", "public", "https://bloctick.netlify.app/static/media/pexels-teddy-yang-2263436.3014268c99d59a7520a4.jpg")
          .send(
            {
              from: accounts[0],
            },
            function (error, transactionHash) {
              //
            }
          )
          .on("error", function (error) {
            console.log(error);
          })
          .on("transactionHash", function (transactionHash) {})
          .on("receipt", function (receipt) {
            alert("Contract address: " + receipt.contractAddress);
            console.log(receipt.contractAddress); // contains the new contract address
          });
      });
    }
  </script>
</html>
